# jobs/titanic_job.yaml
name: titanic_pipeline

# Run all tasks in repo context
git_source:
  git_url: https://github.com/SujitRaval1010/titanic-pipeline
  git_provider: github
  git_branch: main

# Define a reusable cluster for all tasks
job_clusters:
  - job_cluster_key: shared_cluster
    new_cluster:
      spark_version: 13.3.x-scala2.12
      node_type_id: Standard_DS3_v2
      num_workers: 2

tasks:
  - task_key: data_prep
    description: "Step 1: Data Preprocessing"
    job_cluster_key: shared_cluster
    notebook_task:
      notebook_path: /Repos/SujitRaval1010/titanic-pipeline/notebooks/01_data_prep
    environment_variables:
      MLFLOW_TRACKING_URI: databricks
      MLFLOW_EXPERIMENT_NAME: /Shared/titanic
      MLFLOW_MODEL_NAME: workspace.my_schema.titanic_model
      MLFLOW_MODEL_STAGE: Staging

  - task_key: train
    description: "Step 2: Model Training"
    depends_on:
      - task_key: data_prep
    job_cluster_key: shared_cluster
    notebook_task:
      notebook_path: /Repos/SujitRaval1010/titanic-pipeline/notebooks/02_train
    environment_variables:
      MLFLOW_TRACKING_URI: databricks
      MLFLOW_EXPERIMENT_NAME: /Shared/titanic
      MLFLOW_MODEL_NAME: workspace.my_schema.titanic_model
      MLFLOW_MODEL_STAGE: Staging

  - task_key: evaluate
    description: "Step 3: Model Evaluation"
    depends_on:
      - task_key: train
    job_cluster_key: shared_cluster
    notebook_task:
      notebook_path: /Repos/SujitRaval1010/titanic-pipeline/notebooks/03_evaluate
    environment_variables:
      MLFLOW_TRACKING_URI: databricks
      MLFLOW_EXPERIMENT_NAME: /Shared/titanic
      MLFLOW_MODEL_NAME: workspace.my_schema.titanic_model
      MLFLOW_MODEL_STAGE: Staging

  - task_key: register
    description: "Step 4: Model Registration"
    depends_on:
      - task_key: evaluate
    job_cluster_key: shared_cluster
    notebook_task:
      notebook_path: /Repos/SujitRaval1010/titanic-pipeline/notebooks/04_register_model
    environment_variables:
      MLFLOW_TRACKING_URI: databricks
      MLFLOW_EXPERIMENT_NAME: /Shared/titanic
      MLFLOW_MODEL_NAME: workspace.my_schema.titanic_model
      MLFLOW_MODEL_STAGE: Staging
